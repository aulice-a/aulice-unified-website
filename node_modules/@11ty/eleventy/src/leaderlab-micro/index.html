---
layout: base.html
title: Leader Lab & Macro-Gateway
permalink: /leaderlab-micro/
---

<style>
    .container {
        max-width: 800px;
    }
    .step-section {
        display: none;
    }
    .step-section.active {
        display: block;
    }

    /* Full-screen CTA overlay with animations */
    #cta-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
        cursor: pointer;
        transition: background-color 1s ease-in-out;
    }

    .cta-text-container {
        opacity: 0;
        transition: opacity 1s ease-in-out, transform 1s ease-in-out;
        transform: translateY(20px);
    }

    .cta-text-container.active {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* New styles for the click indicator */
    .click-indicator {
        opacity: 0;
        transition: opacity 1s ease-in-out;
        animation: bounce 2s infinite;
    }

    .click-indicator.active {
        opacity: 1;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    /* Initial screen before app loads */
    #splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #F3F4F6;
        z-index: 100;
    }

    .loader {
        border: 8px solid #E5E7EB;
        border-top: 8px solid #3B82F6;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<div id="splash-screen">
    <div class="loader"></div>
</div>

<div id="cta-overlay" class="text-white text-center p-8 flex flex-col justify-center">
    <div class="cta-text-container">
        <h1 class="text-4xl md:text-5xl font-bold max-w-lg mx-auto leading-snug"></h1>
        <p id="click-indicator" class="mt-4 text-xl font-medium">Click to continue 👇</p>
    </div>
</div>

<div id="app" class="container bg-white p-8 md:p-12 rounded-2xl shadow-xl space-y-8 absolute hidden">

    <nav id="app-navigation" class="flex justify-between items-center mb-6 hidden">
        <button id="nav-back-btn" class="text-blue-600 hover:text-blue-800 transition duration-300">
            &larr; Back
        </button>
        <span class="text-sm font-medium text-gray-500"></span>
    </nav>

    <div id="initial-cta-section" class="step-section active text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Level Up Your Professional English</h1>
        <p class="text-lg text-gray-600 mb-8 max-w-lg mx-auto">Discover how your professional language skills measure up with our quick and interactive Leader Lab. It's free, fast, and tailored just for you.</p>
        <button id="cta-button" class="px-8 py-4 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Start Your Leader Lab Challenge
        </button>
    </div>

    <div id="profession-section" class="step-section text-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">What's Your Profession?</h2>
        <div class="space-y-4">
            <p class="text-gray-600">Choose your field to get a tailored assessment:</p>
            <select id="profession-select" class="w-full md:w-2/3 lg:w-1/2 mx-auto p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">Select a Profession</option>
                <option value="Logistics Coordinator">Logistics Coordinator</option>
                <option value="Banking Professionals">Banking Professionals</option>
                <option value="Mining Engineers">Mining Engineers</option>
                <option value="Medical Professionals">Medical Professionals</option>
                <option value="Oil & Gas Professionals">Oil & Gas Professionals</option>
                <option value="Pilot & ATCs">Pilot & ATCs</option>
                <option value="Aestheticians">Aestheticians</option>
                <option value="Legal Professionals">Legal Professionals</option>
                <option value="Hotel & Hospitality Professionals">Hotel & Hospitality Professionals</option>
                <option value="Cabin Crew Professionals">Cabin Crew Professionals</option>
                <option value="Other">Other</option>
            </select>
            <div id="other-profession-input" class="hidden space-y-2 mt-4">
                <label for="manual-profession" class="block text-sm font-medium text-gray-700 text-left">Insert the name of your profession</label>
                <div class="bg-yellow-50 text-yellow-800 p-4 rounded-lg shadow-sm">
                    <p class="text-sm font-medium">We'll create you a custom-tailored course on demand during the free class!</p>
                </div>
                <input type="text" id="manual-profession" required class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <button id="profession-submit" class="w-full md:w-2/3 lg:w-1/2 mx-auto py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                Next
            </button>
        </div>

        <div id="simulator-link-section" class="step-section text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Explore Your Professional Simulator</h2>
            <p class="text-gray-600 mb-6 max-w-lg mx-auto">Click below to experience a real-world scenario tailored to your profession. It's a quick preview of our immersive learning.</p>
            <a id="simulator-link" href="#" target="_blank" class="inline-block px-8 py-4 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                Launch Simulator
            </a>
            <p class="text-sm text-gray-500 mt-4">This will open in a new tab.</p>
            <button id="simulator-link-continue" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-300 mt-8">
                Continue to Assessment
            </button>
        </div>

        <div id="other-simulator-option-section" class="step-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Your Simulator Will Be Like This...</h2>
            <p class="text-lg text-gray-600 mb-8 text-center">Here are a few examples of our professional simulators. Your custom-tailored simulator and course will be created for you during your free class.</p>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                <a href="/banking-simulator/" target="_blank" class="flex flex-col items-center text-center p-4 bg-gray-50 rounded-lg shadow-sm hover:bg-gray-100 transition duration-300">
                    <img src="https://placehold.co/100x100/FEE2E2/B91C1C?text=💼" alt="Banking Icon" class="rounded-full mb-2">
                    <p class="text-sm font-semibold">Banking Professionals</p>
                </a>
                <a href="/pilot-atc-simulator/" target="_blank" class="flex flex-col items-center text-center p-4 bg-gray-50 rounded-lg shadow-sm hover:bg-gray-100 transition duration-300">
                    <img src="https://placehold.co/100x100/DBEAFE/1D4ED8?text=✈️" alt="Pilot Icon" class="rounded-full mb-2">
                    <p class="text-sm font-semibold">Pilot & ATCs</p>
                </a>
                <a href="/hotel-simulator/" target="_blank" class="flex flex-col items-center text-center p-4 bg-gray-50 rounded-lg shadow-sm hover:bg-gray-100 transition duration-300">
                    <img src="https://placehold.co/100x100/F0F9FF/0C4A6E?text=🏨" alt="Hotel Icon" class="rounded-full mb-2">
                    <p class="text-sm font-semibold">Hotel & Hospitality</p>
                </a>
            </div>
            <p class="text-lg text-gray-600 mt-8 text-center">Now, let's proceed with a quick assessment to get a sense of your professional vocabulary.</p>
            <div class="text-center mt-6">
                <button id="other-simulator-continue" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-300">
                    Continue to Assessment
                </button>
            </div>
        </div>

        <div id="quiz-section" class="step-section">
            <h2 id="quiz-heading" class="text-3xl font-bold text-gray-800 mb-6 text-center">Quick Leadership Challenge</h2>
            <div id="quiz-questions" class="space-y-6 mb-6">
                </div>
            <div class="text-center">
                <button id="quiz-submit" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-300">
                    Check My Answers
                </button>
            </div>
        </div>

        <div id="form-section" class="step-section">
            <div id="quiz-result-message" class="text-center p-4 rounded-lg mb-6"></div>
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Unlock Your Free Class Assessment</h2>
            
            <form id="user-info-form-netlify" name="LeaderLabLead" method="POST" data-netlify="true" class="space-y-4">
                <input type="hidden" name="form-name" value="LeaderLabLead" />
                
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="name" name="name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="contact" class="block text-sm font-medium text-gray-700">Email Address</label>
                    <input type="email" id="contact" name="contact" required class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="goal" class="block text-sm font-medium text-gray-700">Your Current Goal</label>
                    <select id="goal" name="goal" required class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select a Goal</option>
                        <option value="promotion">Promotion</option>
                        <option value="relocation">Relocation</option>
                        <option value="test">Language Test</option>
                        <option value="upgrade">Skill Upgrade</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <input type="hidden" name="profession_chosen" id="hidden_profession_chosen">
                <input type="hidden" name="quiz_score" id="hidden_quiz_score">

                <button type="submit" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
                    Submit & Continue
                </button>
            </form>
        </div>

        <div id="final-section" class="step-section text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Congratulations!</h2>
            <p class="text-lg text-gray-600 mb-4">You've earned a **free class assessment** and a customized roadmap to achieve your goals.</p>
            <p class="text-gray-500 mb-8">Click the link below to schedule your personal session with one of our experts.</p>
            <a href="https://calendly.com/aulice" target="_blank" class="inline-block px-8 py-4 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                Schedule My Free Session
            </a>
            <div class="mt-6">
                <button id="share-btn" class="px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-300 transition duration-300">
                    Share this with a friend!
                </button>
                <p id="share-message" class="text-sm text-green-600 mt-2 hidden">Link copied to clipboard!</p>
            </div>
            
            <div class="mt-8 text-gray-500">
                <p>Already a member?</p>
                <button id="login-button" class="mt-2 text-blue-600 hover:underline">Go to Macro-Gateway</button>
            </div>
        </div>

        <div id="macro-gateway-section" class="step-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Your Monthly Learning Plan</h2>
            <p class="text-lg text-gray-600 mb-8 text-center">Here is your full schedule for the month. Each unit is designed to build on the last, ensuring you master every skill.</p>
            <div class="space-y-6">
                <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">Week 1: Foundational Communication</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>Lesson 1.1: Master Class: Pitching Your Ideas</li>
                        <li>Lesson 1.2: Grammar Lab: Advanced Tense Usage</li>
                        <li>Unit 1.3: Vocabulary Builder: Business Finance Terms</li>
                    </ul>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">Week 2: Advanced Negotiation Skills</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>Lesson 2.1: Master Class: Conflict Resolution & Persuasion</li>
                        <li>Lesson 2.2: Grammar Lab: Subjunctive Mood for Proposals</li>
                        <li>Unit 2.3: Vocabulary Builder: Legal & Contract Terms</li>
                    </ul>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">Week 3: Data-Driven Presentation</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>Lesson 3.1: Master Class: Communicating Complex Data</li>
                        <li>Lesson 3.2: Grammar Lab: Using Conjunctions for Cohesion</li>
                        <li>Unit 3.3: Vocabulary Builder: Data Analysis & Metrics</li>
                    </ul>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-blue-800 mb-2">Week 4: Global Leadership & Cultural Nuances</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li>Lesson 4.1: Master Class: Leading Cross-Cultural Teams</li>
                        <li>Lesson 4.2: Grammar Lab: Formal vs. Informal Language</li>
                        <li>Unit 4.3: Vocabulary Builder: Diplomacy & Etiquette</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // All your simulator links are converted to relative paths
        const simulatorLinks = {
            'Logistics Coordinator': '/logistics-simulator/',
            'Banking Professionals': '/banking-simulator/',
            'Mining Engineers': '/mining-simulator/',
            'Medical Professionals': '/medical-simulator/',
            'Oil & Gas Professionals': '/oil-gas-simulator/',
            'Pilot & ATCs': '/pilot-atc-simulator/',
            'Aestheticians': '/aesthetician-simulator/',
            'Legal Professionals': '/legal-simulator/',
            'Hotel & Hospitality Professionals': '/hotel-simulator/',
            'Cabin Crew Professionals': '/cabin-crew-simulator/'
        };

        const quizData = {
            // ... (QUIZ DATA IS UNCHANGED)
            professions: {
                'Logistics Coordinator': [
                    { question: 'We need to track the ... of the shipment to ensure a timely delivery.', answer: 'status' },
                    { question: 'The team will ... the inventory to ensure accuracy.', answer: 'verify' },
                    { question: 'Please provide an ... of the current stock levels.', answer: 'overview' }
                ],
                'Banking Professionals': [
                    { question: 'The client\'s loan ... was approved after a full review.', answer: 'application' },
                    { question: 'We must conduct a thorough financial ... of the new client.', answer: 'analysis' },
                    { question: 'The bank offers a variety of products to help clients ... their portfolios.', answer: 'diversify' }
                ],
                'Mining Engineers': [
                    { question: 'The primary goal is to ... the mineral deposit efficiently and safely.', answer: 'extract' },
                    { question: 'We need to reassess the rock ... to determine the best method of excavation.', answer: 'formation' },
                    { question: 'The team must ensure proper ... to safety regulations at all times.', answer: 'adherence' }
                ],
                'Medical Professionals': [
                    { question: 'The patient\'s vital signs are ... and do not require immediate intervention.', answer: 'stable' },
                    { question: 'We need to perform a full ... to determine the cause of the symptoms.', answer: 'diagnosis' },
                    { question: 'The doctor must ... the patient\'s condition to the family.', answer: 'communicate' }
                ],
                'Oil & Gas Professionals': [
                    { question: 'The new well is expected to ... a high volume of crude oil.', answer: 'produce' },
                    { question: 'We must carefully ... the pipeline for any signs of corrosion.', answer: 'inspect' },
                    { question: 'The team is responsible for the safe ... of the drilling operation.', answer: 'management' }
                ],
                'Pilot & ATCs': [
                    { question: 'Air traffic control has granted us ... to land on runway 27.', answer: 'clearance' },
                    { question: 'We must follow the flight plan to ... our arrival time.', answer: 'optimize' },
                    { question: 'Please report any unexpected changes in the ... to the tower.', answer: 'altitude' }
                ],
                'Aestheticians': [
                    { question: 'The treatment is designed to ... the skin and improve its texture.', answer: 'rejuvenate' },
                    { question: 'We will use a gentle cleanser to remove all ... from your skin.', answer: 'impurities' },
                    { question: 'Please inform me of any known skin ... before we begin.', answer: 'sensitivities' }
                ],
                'Legal Professionals': [
                    { question: 'The defense attorney plans to ... the witness to challenge their testimony.', answer: 'cross-examine' },
                    { question: 'The judge will issue a final ... after hearing all the evidence.', answer: 'verdict' },
                    { question: 'We need to draft a comprehensive ... outlining the terms of the agreement.', answer: 'contract' }
                ],
                'Hotel & Hospitality Professionals': [
                    { question: 'The check-in process requires a valid form of ... from each guest.', answer: 'identification' },
                    { question: 'Our goal is to ensure a high level of ... during the guest\'s stay.', answer: 'satisfaction' },
                    { question: 'Please ... the guest\'s request for an extra pillow to housekeeping.', answer: 'forward' }
                ],
                'Cabin Crew Professionals': [
                    { question: 'Please ensure all passengers are safely ... before takeoff.', answer: 'seated' },
                    { question: 'The crew is trained to handle any in-flight ... effectively.', answer: 'emergency' },
                    { question: 'Our main priority is to ensure passenger ... throughout the flight.', answer: 'safety' }
                ]
            },
            generic: [
                { question: 'The team needs to be more ... when facing unexpected challenges.', answer: 'flexible' },
                { question: 'Our new leader is excellent at providing clear and effective ... to the team.', answer: 'feedback' },
                { question: 'In order to build consensus, we must first find a common ... for the team to agree on.', answer: 'ground' },
            ]
        };

        const steps = ['initial-cta-section', 'profession-section', 'simulator-link-section', 'other-simulator-option-section', 'quiz-section', 'form-section', 'final-section', 'macro-gateway-section'];

        const elements = {
            splashScreen: document.getElementById('splash-screen'),
            ctaOverlay: document.getElementById('cta-overlay'),
            ctaTextContainer: document.querySelector('#cta-overlay .cta-text-container'),
            ctaText: document.querySelector('#cta-overlay h1'),
            clickIndicator: document.getElementById('click-indicator'),
            app: document.getElementById('app'),
            appNav: document.getElementById('app-navigation'),
            navBackBtn: document.getElementById('nav-back-btn'),
            ctaButton: document.getElementById('cta-button'),
            professionSelect: document.getElementById('profession-select'),
            professionSubmit: document.getElementById('profession-submit'),
            otherProfessionInput: document.getElementById('other-profession-input'),
            manualProfessionInput: document.getElementById('manual-profession'),
            simulatorLinkSection: document.getElementById('simulator-link-section'),
            simulatorLink: document.getElementById('simulator-link'),
            simulatorLinkContinue: document.getElementById('simulator-link-continue'),
            otherSimulatorOptionSection: document.getElementById('other-simulator-option-section'),
            otherSimulatorContinue: document.getElementById('other-simulator-continue'),
            quizQuestions: document.getElementById('quiz-questions'),
            quizSubmit: document.getElementById('quiz-submit'),
            // Reference the NEW Netlify form ID
            userInfoForm: document.getElementById('user-info-form-netlify'), 
            quizResultMessage: document.getElementById('quiz-result-message'),
            loginButton: document.getElementById('login-button'),
            shareBtn: document.getElementById('share-btn'),
            shareMessage: document.getElementById('share-message'),
            // NEW: Hidden form fields
            hiddenProfession: document.getElementById('hidden_profession_chosen'),
            hiddenQuizScore: document.getElementById('hidden_quiz_score')
        };

        let currentStepIndex = 0;
        let chosenProfession = '';
        let quizScore = 0; // NEW: Track the score

        // Function to show a specific step within the main app
        function showStep(stepId) {
            steps.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    section.classList.remove('active');
                }
            });
            const activeSection = document.getElementById(stepId);
            if (activeSection) {
                activeSection.classList.add('active');
            }

            currentStepIndex = steps.indexOf(stepId);
            // Show/hide navigation based on step
            if (stepId === 'initial-cta-section' || stepId === 'final-section' || stepId === 'macro-gateway-section') {
                elements.appNav.classList.add('hidden');
            } else {
                elements.appNav.classList.remove('hidden');
            }
            window.scrollTo(0, 0); // Scroll to top when step changes
        }

        // NEW: Back button functionality
        elements.navBackBtn.addEventListener('click', () => {
            if (currentStepIndex > 1) { // Cannot go back from the first app step
                showStep(steps[currentStepIndex - 1]);
            }
        });

        // Dynamic CTA Logic (UNCHANGED)
        const ctaData = [
            { text: "Can you manage global logistics in a crisis?", color: "bg-blue-600" },
            { text: "Can you explain a complex financial product to a client?", color: "bg-red-600" },
            { text: "Can you manage a team in a high-risk excavation?", color: "bg-yellow-600" },
            { text: "Can you diagnose a rare condition under pressure?", color: "bg-green-600" },
            { text: "Can you coordinate an offshore drilling operation?", color: "bg-gray-900" },
            { text: "Can you handle an emergency landing in English?", color: "bg-purple-600" },
            { text: "Can you build client loyalty with your expertise?", color: "bg-orange-600" },
            { text: "Can you negotiate a high-stakes corporate merger?", color: "bg-pink-600" },
            { text: "Can you manage a difficult customer complaint in a hotel?", color: "bg-teal-600" },
            { text: "Can you lead a crew and ensure passenger safety?", color: "bg-indigo-600" }
        ];

        let ctaIndex = 0;
        let ctaInterval;

        function updateCta() {
            const data = ctaData[ctaIndex];
            elements.ctaTextContainer.classList.remove('active');
            elements.clickIndicator.classList.remove('active');

            setTimeout(() => {
                elements.ctaOverlay.className = 'text-white text-center p-8 flex flex-col justify-center'; // Reset classes
                elements.ctaOverlay.classList.add(data.color);
                elements.ctaText.textContent = data.text;
                elements.ctaTextContainer.classList.add('active');
                elements.clickIndicator.classList.add('active');
                ctaIndex = (ctaIndex + 1) % ctaData.length;
            }, 1000); // Wait for fade-out before changing content
        }

        // Show the dynamic CTA screen on load
        window.onload = () => {
            elements.splashScreen.style.display = 'none';
            elements.ctaOverlay.style.display = 'flex';
            updateCta();
            ctaInterval = setInterval(updateCta, 4000);
        };

        // Handle click on the CTA overlay
        elements.ctaOverlay.addEventListener('click', () => {
            clearInterval(ctaInterval);
            elements.ctaOverlay.style.display = 'none';
            elements.app.classList.remove('hidden');
            showStep('initial-cta-section');
        });

        // Main App Logic
        elements.ctaButton.addEventListener('click', () => {
            showStep('profession-section');
        });

        elements.professionSelect.addEventListener('change', (e) => {
            if (e.target.value === 'Other') {
                elements.otherProfessionInput.classList.remove('hidden');
                elements.manualProfessionInput.setAttribute('required', 'required');
            } else {
                elements.otherProfessionInput.classList.add('hidden');
                elements.manualProfessionInput.removeAttribute('required');
            }
        });

        elements.professionSubmit.addEventListener('click', () => {
            const profession = elements.professionSelect.value;
            if (!profession) {
                alert("Please select a profession or choose 'Other'."); // Added simple alert for user
                return;
            }
            chosenProfession = profession;

            if (profession === 'Other') {
                if (!elements.manualProfessionInput.value.trim()) {
                    alert("Please enter the name of your profession.");
                    return;
                }
                chosenProfession = elements.manualProfessionInput.value.trim();
                showStep('other-simulator-option-section');
            } else {
                const simulatorUrl = simulatorLinks[profession];
                elements.simulatorLink.href = simulatorUrl;
                showStep('simulator-link-section');
            }
        });

        elements.simulatorLinkContinue.addEventListener('click', () => {
            populateQuiz();
            showStep('quiz-section');
        });

        elements.otherSimulatorContinue.addEventListener('click', () => {
            populateQuiz(true); // pass true to indicate "other" profession
            showStep('quiz-section');
        });

        function populateQuiz(isOther = false) {
            // ... (QUIZ POPULATION LOGIC REMAINS UNCHANGED)
            let questions;
            if (isOther) {
                questions = quizData.generic;
                document.getElementById('quiz-heading').textContent = "Quick Professional English Assessment";
            } else {
                questions = quizData.professions[chosenProfession];
                document.getElementById('quiz-heading').textContent = `Quick ${chosenProfession} Challenge`;
            }

            const shuffled = questions.sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, Math.min(questions.length, 3));

            elements.quizQuestions.innerHTML = '';
            selected.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.innerHTML = `
                    <p class="mb-2 text-gray-700">${index + 1}. ${q.question}</p>
                    <input type="text" data-answer="${q.answer.toLowerCase()}" required class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                `;
                elements.quizQuestions.appendChild(questionElement);
            });
        }

        elements.quizSubmit.addEventListener('click', () => {
            const inputs = elements.quizQuestions.querySelectorAll('input');
            let correctCount = 0;
            inputs.forEach(input => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = input.dataset.answer.toLowerCase();
                
                // NEW: Visual feedback for the quiz
                input.classList.remove('border-gray-300', 'border-red-500', 'border-green-500');
                if (userAnswer === correctAnswer) {
                    correctCount++;
                    input.classList.add('border-green-500', 'border-4');
                } else {
                    input.classList.add('border-red-500', 'border-4');
                }
            });
            
            quizScore = correctCount; // Store the score
            const totalQuestions = inputs.length;
            const percentage = (correctCount / totalQuestions) * 100;
            
            // Generate result message
            let message = '';
            let messageColor = '';

            if (percentage === 100) {
                message = `Excellent! You scored ${correctCount}/${totalQuestions}. Your professional English is sharp!`;
                messageColor = 'bg-green-100 text-green-800';
            } else if (percentage >= 50) {
                message = `Great effort! You scored ${correctCount}/${totalQuestions}. You have a strong foundation.`;
                messageColor = 'bg-yellow-100 text-yellow-800';
            } else {
                message = `Good start! You scored ${correctCount}/${totalQuestions}. Let's focus on the key vocabulary in our free class.`;
                messageColor = 'bg-red-100 text-red-800';
            }

            elements.quizResultMessage.className = `text-center p-4 rounded-lg mb-6 ${messageColor}`;
            elements.quizResultMessage.innerHTML = `<p class="font-semibold">${message}</p>`;

            // Prepare hidden fields for form submission
            elements.hiddenProfession.value = chosenProfession;
            elements.hiddenQuizScore.value = `${correctCount}/${totalQuestions}`;

            // Automatically move to the form after a short delay to let the user see the score
            setTimeout(() => {
                showStep('form-section');
            }, 1500);
        });
        
        // **NETLIFY FORM SUBMISSION HANDLING**
        elements.userInfoForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const form = e.target;
            
            // Netlify requires this standard URL encoding for non-AJAX forms
            const data = new URLSearchParams(new FormData(form)).toString();

            try {
                const response = await fetch(form.action || window.location.href, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: data
                });

                if (response.ok) {
                    // Success! Move to the final confirmation screen
                    showStep('final-section');
                } else {
                    // Handle non-200 responses if needed, though Netlify usually handles it.
                    alert('Submission failed. Please try again.');
                }
            } catch (error) {
                console.error('Form submission error:', error);
                alert('An error occurred. Please check your connection and try again.');
            }
        });
        
        // Share Button Logic (Simple clipboard copy)
        elements.shareBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(window.location.href).then(() => {
                elements.shareMessage.classList.remove('hidden');
                setTimeout(() => {
                    elements.shareMessage.classList.add('hidden');
                }, 2000);
            });
        });
        
        // Login Button Logic
        elements.loginButton.addEventListener('click', () => {
            showStep('macro-gateway-section');
        });

        // Ensure the form is properly reset if the user navigates back
        elements.navBackBtn.addEventListener('click', () => {
            elements.userInfoForm.reset();
        });

    </script>